---
updated_at: 2025-12-11T12:37:23.666+10:00
tags:
  - part1
  - chapter2
---
В прод идут не знания экспертов в предметной области, в прод идут предположения (assumptions) разработчиков... 
	*– Альберто Брандолини (Alberto Brandolini)*

В предыдущей главе началось изучение предметных областей. Были рассмотрены способы определения предметных областей и сферы деятельности компаний, методы анализа ее стратегии, позволяющие конкурировать в этих областях, а также намечена методика определения границ и типов поддоменов компании. 
В этой главе будет продолжена тема анализа предметной области, но в другом, более глубоком измерении. Основное внимание будет уделено всему происходящему внутри поддомена: его бизнес-функциям и логике. Вам предстоит изучение инструмента предметно-ориентированного проектирования для эффективного общения и обмена знаниями: единый язык (ubiquitous language). Здесь он будет использоваться для изучения тонкостей поддоменов бизнеса. Позже в книге он будет использоваться для моделирования и реализации бизнес-логики поддоменов в программных продуктах.


## Задачи бизнеса (business problems) 
Создаваемые нами программные системы решают бизнес-задачи. В этом контексте «задача» (problem) не похожа на математическую задачу или загадку, которая может иметь окончательное решение... В контексте бизнеса слово «задача» имеет более широкое значение. Бизнес-задачей могут быть оптимизация рабочих процессов, минимизация ручного труда, управление ресурсами, поддержка принятия решений, управление данными и т. д. 
Бизнес-задачи ставятся как на уровне предметной области, так и на уровне поддомена. Цель компании — предоставить решение задач своих клиентов. Если вернуться к рассмотренному в первой главе примеру с FedEx, то клиенты этой компании нуждаются в срочной отправке посылок, поэтому процесс доставки подвергается оптимизации. 
Поддомены представляют собой более мелкие предметные области, целью которых является предоставление решений (solution) для конкретных бизнес-компетенций (capabilities). Поддомен управления знаниями требует оптимизации процесса хранения и извлечения информации. Поддомен системы взаиморасчетов требует оптимизаци процесса выполнения финансовых операций. Бухгалтерский поддомен нуждается в отслеживании движения средств компании.

### Выявление экспертных знаний 
Разработка эффективных программных решений невозможна без как минимум базовых знаний предметной области. В первой главе уже упоминалось, что такими знаниями обладают эксперты в той или иной предметной области: их работа состоит в приобретении конкретных знаний и в умении разбираться во всех тонкостях выбранного направления. Но разработчики ни в коем случае не должны, да и не могут, становиться экспертами в предметной области. И тем не менее для них крайне важно понимать экспертов в предметной области и использовать применяемую ими терминологию. 
Эффективность решения зависит от того, насколько хорошо разработчик понимает способ мышления эксперта и его ментальную модель. Без понимания бизнес-задачи и обоснования требований принимаемые решения будут ограничены «переводом» бизнес-требований в исходный код. А что если в требованиях упущен важный граничный случай? Или отсутствует описание бизнес-концепции, ограничивающей возможность реализации модели, способной соответствовать будущим требованиям? 
Как говорит Альберто Брандолини (Alberto Brandolini)1 , разработка программного обеспечения — это процесс обучения, а рабочий код является побочным эффектом. Успех программного проекта зависит от эффективности обмена знаниями между экспертами в предметной области и разработчиками программного обеспечения. Чтобы решить задачу, нужно понять ее суть. 
Эффективный обмен знаниями между экспертами в предметной области и разработчиками программного продукта требует продуктивного общения. Давайте рассмотрим, что чаще всего может препятствовать продуктивному общению в проектах по разработке программных продуктов.

Общение 
Можно с уверенностью сказать, что почти все программные проекты требуют сотрудничества заинтересованных сторон, пребывающих в разных ролях: экспертов предметной области, владельцев продуктов, разработчиков, дизайнеров пользовательского интерфейса и UX, руководителей проектов, тестировщиков, аналитиков и других специалистов. Как и в любой совместной работе, результат зависит от того, насколько продуктивно все эти стороны могут работать вместе. Например, все ли заинтересованные стороны согласны с тем, какую именно задачу им предстоит решить? И что происходит с самим решением — действительно ли функциональные и нефункциональные требования не содержат противоречий? Для успеха проекта требуется согласие и согласованность по всем связанным с ним вопросам. 
Исследование причин неудачных разработок программных проектов показало, что для успешных проектов необходимо продуктивное общение с целью обмена знаниями. Но, несмотря на важность данного аспекта, продуктивное общение наблюдается в проектах по разработке программных продуктов довольно редко. Зачастую бизнес и разработчики не имеют прямого контакта друг с другом. Знания в предметной области передаются разработчикам соответствующими экспертами. Они предоставляются через людей, играющих роль посредников или «переводчиков», т. е. через системных или бизнес-аналитиков, владельцев продуктов и руководителей проектов. Соответствующий поток обмена общими знаниями показан на рис. 2.1.

![[Рис. 2.1. Процесс обмена знаниями при разработке программного проекта.png]]
В ходе традиционного жизненного цикла разработки программного продукта знания предметной области «переводятся» в удобную для программистов форму, известную как аналитическая модель — описание требований системы, а не понимание стоящей за ней предметной области. 
Хотя намерения могут быть и благими, но такое посредничество опасно для обмена знаниями. При любом переводе происходят потери информации: в данном случае знания предметной области, необходимые для решения бизнес-задач, теряются на пути к разработчикам программного продукта. 
И это не единственный перевод типичного программного проекта: аналитическая модель преобразуется в модель дизайна программного продукта (документ по разработке программного продукта, который преобразуется в модель реализации или в сам исходный код). Но, как это часто бывает, документы быстро устаревают. Исходный код используется для передачи знаний о предметной области тем программистам, которые позже будут сопровождать проект. На рис. 2.2 показаны различные переводы, необходимые для реализации знаний предметной области в виде программного кода.

![[Рис. 2.2. Преобразование модели.png]]

Такой процесс разработки программного продукта напоминает детскую игру «Испорченный телефон»2 : информация о предметной области зачастую искажается. Это приводит к тому, что программисты реализуют неверное решение или же само решение, по сути верное, но решает другую задачу. В любом случае результат один: неудачный программный проект. 
Предметно-ориентированное программирование предлагает более эффективный способ передачи знаний от экспертов предметной области к программистам: использование единого языка (ubiquitous language).

### Что такое единый язык? 
Использование единого языка (ubiquitous language) — краеугольный камень предметно-ориентированного проектирования. Идея проста и понятна: если сторонам нужно эффективно общаться, не полагаясь на переводы, они должны говорить на одном и том же языке. 
И хотя это понятие не противоречит здравому смыслу, как сказал Вольтер, «здравый смысл не так уж здрав». Традиционный жизненный цикл разработки программного продукта подразумевает следующие преобразования: 
- Знания предметной области в аналитическую модель. 
- Аналитическую модель в требования. 
- Требования в дизайн. 
- Дизайн в исходный код. 

Вместо постоянного перевода знаний предметной области объектно-ориентированное проектирование требует для описания предметной области разработать единственный (single) единый язык (ubiquitous language).
Все связанные с проектом заинтересованные стороны — программисты, владельцы продуктов, эксперты предметной области, дизайнеры UI/UX — должны при описании предметной области пользоваться единым языком. Самое главное, чтобы экспертам предметной области при рассуждениях о той или иной предметной области было удобно пользоваться единым языком, который будет представлять как саму предметную область, так и ментальные модели экспертов предметной области. 
Способствовать общему пониманию всех заинтересованных сторон проекта может только постоянное использование единого языка и его выражений.

## Язык бизнеса 
Важно подчеркнуть, что единый язык — это язык бизнеса. То есть он должен состоять только из понятий, связанных с предметной областью. В нем не должно быть никакого технического жаргона! Обучать экспертов в области бизнеса синглтонам и абстрактным фабрикам — не ваша цель. Единый язык нацелен на введение понимания экспертами предметной области и ментальных моделей предметной области в рамки легко воспринимаемых понятий.
Сценарии 
Предположим, что работа ведется над системой управления рекламными кампаниями. Рассмотрим следующие утверждения: 
- В рамках рекламной кампании могут демонстрироваться различные креативные материалы. 
- Рекламная кампания может быть запущена, только если хотя бы одно из ее мест размещения активно. 
- Комиссионные за продажу начисляются после подтверждения транзакций. 

Все эти утверждения сформулированы на языке бизнеса. То есть они отражают точку зрения бизнес-экспертов. А вот следующие утверждения являются сугубо техническими и поэтому не соответствуют понятию единого языка: 
- В рекламном iframe-элементе отображает файл HTML. 
- Рекламная кампания может запускаться только при наличии хотя бы одной связанной записи в таблице активных мест размещения. 
- Комиссионные за продажу начисляются на основе соответствующих записей из таблиц транзакций и подтвержденных продаж. 

Все эти последние утверждения носят чисто технический характер и будут непонятны экспертам предметной области. Предположим, что программисты знакомы только с этим техническим, ориентированным на реализацию взглядом на предметную область. В таком случае они не смогут полностью понять бизнес-логику или почему она срабатывает именно таким вот образом, а это ограничит их возможности моделирования и реализации эффективного решения.

### Согласованность 
Единый язык должен быть четко выраженным и согласованным. Тем самым должна быть устранена необходимость в выстраивании предположений, а логика предметной области должна быть выражена в явном виде. 
Поскольку неоднозначность препятствует плодотворному общению, каждое понятие единого языка должно иметь одно-единственное значение. Давайте рассмотрим несколько примеров нечетко выраженной терминологии и то, как ее можно выправить. 

### Неоднозначные понятия 
Предположим, что в какой-то предметной области понятие policy имеет сразу несколько значений: оно может означать как «политику», так и «договор страхования». Точное значение может быть выявлено только в разговоре, в зависимости от контекста. Но среда программирования плохо справляется с неоднозначностью, и моделирование сущности того, что подразумевается под понятием «policy», в программном коде может получиться громоздким и сложным. 
Единый язык требует единого значения для каждого понятия, поэтому понятие «policy» должно быть смоделировано в явном виде с использованием двух понятий: политика и страховой договор. 

### Понятия-синонимы 
Два понятия в едином языке не могут использоваться, заменяя друг друга. Например, во многих системах используется понятие user. Но при тщательном изучении жаргона экспертов предметной области может выясниться, что user и другие понятия используются взаимозаменяемо: например, user (пользователь), visitor (посетитель), administrator (администратор), account (учетная запись) и т. д. 
Поначалу понятия-синонимы могут показаться безвредными. Но в большинстве случаев они обозначают разные понятия. В приведенном выше примере и посетитель, и учетная запись технически относятся к пользователям системы, но в большинстве систем незарегистрированные и зарегистрированные пользователи представляют собой разные роли и ведут себя по-разному. Например, данные «посетителей» используются в основном для проведения анализа, тогда как «учетные записи» фактически используют систему и ее функциональные возможности. 
Каждое понятие лучше использовать явным образом в его конкретном контексте. Осмысление различий между используемыми понятиями позволяет создавать более простые и четкие модели и реализации объектов предметной области.

## Модель предметной области
Теперь давайте посмотрим на единый язык с иной точки зрения: моделирования.

### Что такое модель?
Модель — это упрощенное представление вещи или явления, в котором намеренно подчеркиваются одни аспекты и игнорируются другие. Это абстракция с учетом конкретного использования. 
	*– Ребекка Вирфс-Брок (Rebecca Wirfs-Brock)*

Модель — это не копия реального мира, а созданная человеком конструкция, помогающая нам разобраться в системах реального мира. 
Каноническим примером модели является карта. Как показано на рис. 2.3, моделью является любая карта, будь то навигационная карта, карта местности, карта мира, карта метро и т. д.

![[Рис. 2.3. Различные типы карт, отображающие разные модели Земли.png]]

Ни одна из этих карт не предоставляет всех подробностей нашей планеты. Каждая содержит ровно столько данных, сколько необходимо для ее конкретной цели: той задачи, для решения которой она создана.

### Эффективное моделирование 
У всех моделей есть цель, а эффективная модель содержит только те детали, которые необходимы для достижения этой цели. Например, на карте мира вы не увидите станций метро. Но и карту метро вы не можете использовать для оценки расстояний. Каждая карта содержит только ту информацию, которую она должна предоставлять. 
Следует повторить: полезная модель — это не копия реального мира. Она предназначена для решения конкретной задачи и должна предоставлять для этого достаточный объем информации. Или, как выразился статистик Джордж Бокс (George Box), «все модели неверны, но некоторые полезны». 
По сути, модель является абстракцией. Понятие абстракции позволяет нам справляться со сложностью, опуская ненужные детали и оставляя под рукой только то, что необходимо для решения задачи. С другой стороны, в неэффективной абстракции порой нет необходимого или оставлено ненужное, создающее вредные помехи. Как было отмечено Эдсгером В. Дейкстрой (Edsger W. Dijkstra) в статье «The Humble Programmer», цель абстрагирования не в задании неопределенности, а в создании нового семантического уровня, на котором можно быть абсолютно точным.

### Моделирование предметной области 
Разрабатывая единый язык, мы эффективно выстраиваем модель предметной области. Эта модель должна стать отражением ментальных моделей экспертов предметной области — их осмысления того, как бизнес работает при реализации своей функции. Модель должна отражать охватываемые бизнес-объекты и их поведение, причинно-следственные связи и инварианты. 
Используемый нами единый язык не должен охватывать абсолютно все подробности предметной области. Это было бы равносильно превращению каждого заинтересованного лица в эксперта в этой области. Напротив, предполагается, что модель включает в себя именно то количество аспектов предметной области, которое дает возможность реализовать требуемую систему, т. е. все, что нужно для решения конкретной задачи посредством специально предназначенного для этого программного продукта. В следующих главах будет показано, как единый язык может задавать низкоуровневые решения по проектированию и реализации. 
Эффективное общение команд программистов и экспертов предметной области является основополагающим фактором. Важность этого общения возрастает по мере усложнения предметной области. Чем она сложнее, тем сложнее смоделировать и реализовать ее бизнес-логику. Даже незначительное недопонимание сложной предметной области или ее основных принципов неизбежно приведет к реализации продукта с весьма серьезными дефектами. Единственный надежный способ проверить осмысленность предметной области — пообщаться с экспертами в этой области на понятном им языке: на языке бизнеса. 

### Непрерывная работа 
Разработка единого языка требует общения с его естественными носителями, экспертами предметной области. Только взаимодействие с реальными экспертами может выявить неточности, неверные предположения или совершенно неверное понимание предметной области.
Все заинтересованные стороны должны неизменно пользоваться единым языком при каждом общении, связанным с проектом, чтобы распространять знания о предметной области и вырабатывать взаимопонимание. Язык должен постоянно совершенствоваться на протяжении всего проекта: он должен использоваться в требованиях, тестах, документации и даже в самом исходном коде. 
Самое главное, становление единого языка — процесс непрерывный. Он должен постоянно корректироваться и развиваться. Повседневное использование языка со временем позволит глубже усвоить суть предметной области. При резких подвижках в ее сути должен развиваться и единый язык, дабы идти в ногу с новыми знаниями в предметной области.

Инструменты 
Облегчить процесс освоения единого языка и управления им могут уже существующие инструменты и технологии. 
Например, в качестве глоссария для сохранения данных по единому языку и его документирования можно воспользоваться вики-страницей. Такой глоссарий упростит процесс адаптации новых специалистов команды, поскольку сможет послужить источником информации о терминологии, принятой в предметной области. 
Важно совершенствовать глоссарий совместными усилиями. В условиях изменения единого языка к обновлению глоссария следует привлекать всех специалистов команды. Это идет вразрез с централизованным подходом, при котором ответственность за ведение глоссария возлагается только на руководителей групп или архитекторов. 
Несмотря на очевидные преимущества, получаемые от ведения глоссария проектной терминологии, этому процессу свойственны и явные ограничения. Глоссарии лучше всего подходят для «существительных»: названий сущностей, процессов, ролей и т. д. И хотя существительные тоже важны, главное значение имеет фиксация поведения. Причем поведение — не просто список глаголов, связанных с существительными, а реальная бизнес-логика с ее правилами, предположениями и инвариантами. Задокументировать в глоссарии такие понятия гораздо сложнее. Следовательно, глоссарии лучше всего использовать в тандеме с другими инструментами, которые больше подходят для фиксации поведения; например, сценарии использования или Gherkin-тесты. 
Автоматизированные тесты, написанные на языке Gherkin, — это не только превосходные инструменты для понимания единого языка, но и дополнительный инструмент для преодоления разночтений между экспертами в предметной области и разработчиками программных продуктов. Эксперты предметной области могут читать тесты и проверять ожидаемое поведение системы . Рассмотрим, к примеру, следующий тест, написанный на языке Gherkin:
```text
Scenario: Notify the agent about a new support case 
	Given Vincent Jules submits a new support case saying: 
	""" 
	I need help configuring AWS Infinidash 
	""" 
	When the ticket is assigned to Mr. Wolf 
```
Управление набором Gherkin-тестов порой может быть непростым, особенно на ранних стадиях проекта. И тем не менее для сложных бизнес-областей их определенно стоит проводить. 
Ко всему прочему имеются даже инструменты статического анализа кода, способные проверять использование понятий единого языка. Ярким примером такого инструмента является NDepend. 
При всей своей пользе все эти инструменты вторичны по отношению к фактическому использованию единого языка в повседневном общении. Инструментами следует пользоваться, чтобы справиться с поддержкой единого языка, но не нужно ожидать, что документация заменит его фактическое использование. Как говорится в Agile-манифесте: «Люди и взаимодействие важнее процессов и инструментов».

### Сложности 
В теории разработка единого языка представляется простым и понятным процессом. Но на практике это не всегда так. Единственный надежный способ сбора знаний в предметной области — общение с экспертами. Зачастую самые важные знания не лежат на поверхности. Они нигде не задокументированы и не систематизированы и существуют только лишь в сознании экспертов предметной области. Единственный способ получить к ним доступ — задавать вопросы. 
По мере накопления опыта в приобретении знаний станет заметно, что довольно часто этот процесс заключается не просто в выявлении уже имеющихся знаний, а является совместным созданием модели в тандеме с экспертами предметной области. У самих экспертов могут быть неясности и даже пробелы в собственном понимании бизнес-сферы. Например, определение только «позитивных» сценариев без рассмотрения граничных случаев, бросающих вызов принятым предположениям. Кроме того, можно столкнуться с концепциями предметных областей, которым не хватает явных определений. Подобные скрытые несоответствия и пробелы чаще всего выявляются, когда задаются вопросы о характере предметной области. Особенно это касается основных поддоменов (core subdomains). В таком случае процесс обучения является взаимным — вы помогаете экспертам в предметной области лучше понять свою область. 
При внедрении методов предметно-ориентированного проектирования в уже существующий проект можно заметить, что для описания предметной области уже есть сформированный язык и заинтересованные стороны уже им пользуются. Но, поскольку этот язык сформировался без следования предметно-ориентированному проектированию, еще не факт, что он будет эффективно отражать предметную область. Например, в нем могут использоваться такие технические термины, как имена таблиц базы данных. Изменить язык, который уже используется в организации, весьма непросто. Главный инструмент в такой ситуации — терпение. Нужно убедиться, что вполне приемлемый язык используется там, где его легко проконтролировать: в документации и в исходном коде. 
И наконец, отвечу на вопрос о едином языке, который мне часто задают на конференциях: какой язык нужно использовать, если компания находится не в англоязычной стране. Мой совет — воспользуйтесь английскими существительными как минимум для наименования объектов в предметной области. Это упростит использование одной и той же терминологии в программном коде.

## Вывод 
Для успешного ведения проекта по созданию программного продукта решающее значение имеют эффективное общение и обмен знаниями. Чтобы спроектировать и создать программное решение, программисты должны разбираться в предметной области. 
Единый язык (ubiquitous language) предметно-ориентированного проектирования является эффективным инструментом преодоления разрыва в знаниях между экспертами в предметной области и разработчиками программного продукта. Совершенствование единого языка, который может использоваться всеми заинтересованными сторонами в ходе всего проекта: в разговорах, в документации, в тестах, в диаграммах, в исходном коде и т. д., способствует общению и обмену знаниями. 
Чтобы общение было плодотворным, единый язык должен устранять неопределенности и скрытые предположения. Все понятия языка должны быть согласованы — никаких неоднозначных терминов и синонимов. 
Развитие единого языка — непрерывный процесс. По мере разработки проекта будет выявляться все больше подробностей предметной области. Важно, чтобы они находили свое отражение в едином языке. 
Существенно облегчить процесс документирования и поддержки единого языка можно с помощью таких инструментов, как глоссарии на основе вики-страниц и Gherkin-тесты. И все же залогом успеха единого языка является его применение: язык должен постоянно использоваться во всех информационных обменах, связанных с проектом.