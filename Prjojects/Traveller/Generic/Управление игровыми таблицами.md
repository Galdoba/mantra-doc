---
updated_at: 2026-01-28T15:31:07.981+10:00
tags:
  - package
---
# Пакет tttable (Table Top TABLEs)

`/cepheus/pgk/tttable`

## Назначение

Пакет `tttable` предоставляет инфраструктуру для работы с таблицами диапазонных ключей, характерных для настольных ролевых игр (TTRPG) и других систем, где требуется детерминированный выбор результата на основе числового входа с поддержкой каскадных ссылок. Пакет фокусируется исключительно на управлении таблицами и их использовании, оставляя аспекты генерации случайных чисел, вероятностных распределений и построения выражений для бросков внешним компонентам.

## Возможности

### Основные возможности:
- **Диапазонные таблицы**: Создание таблиц с именем и набором строк "ключ-значение", где ключи поддерживают:
  - Одиночные числа (например, "5")
  - Закрытые диапазоны ("1-5", "-3-7")
  - Открытые диапазоны ("5+", "10-")
- **Модификаторы**: Встроенная система именованных модификаторов для корректировки бросков
- **Каскадные ссылки**: Результат броска может быть именем другой таблицы, создавая цепочки определений
- **Коллекции**: Управление множеством взаимосвязанных таблиц с автоматическим обнаружением циклических ссылок
- **Сериализация**: Поддержка JSON, TOML и YAML форматов для персистентности
- **Валидация**: Автоматическая проверка корректности таблиц, включая проверку непересекаемости диапазонов

### Дополнительные возможности:
- **Функциональные опции**: Гибкая система конфигурации через паттерн functional options
- **Агностицизм генератора**: Возможность использования любого источника случайности через интерфейс `Roller`
- **Опциональное логирование**: Детализация процесса броска при наличии writer'а

## Преимущества перед аналогами

### По сравнению с простыми map-структурами:
- **Структурированные ключи**: Поддержка диапазонов вместо только фиксированных значений
- **Встроенная валидация**: Автоматическая проверка на пересечения диапазонов и корректность форматов
- **Система модификаторов**: Встроенная поддержка именованных модификаторов для корректировки бросков

### По сравнению с другими библиотеками для TTRPG:
- **Гибкость форматов ключей**: Поддержка открытых диапазонов, отрицательных значений и смешанных диапазонов
- **Встроенная каскадность**: Поддержка цепочек таблиц с автоматическим обнаружением циклов
- **Независимость от генератора**: Интерфейсная архитектура позволяет использовать любой RNG
- **Мультиформатная сериализация**: Единый API для работы с тремя популярными форматами данных

### Архитектурные преимущества:
- **Чистые интерфейсы**: Чёткое разделение ответственности между компонентами
- **Иммутабельность конфигурации**: Functional options обеспечивают безопасное конфигурирование объектов
- **Расширяемость**: Простота добавления новых форматов сериализации через существующие интерфейсы

## Сценарии использования

### В настольных ролевых играх:
- **Таблицы случайных встреч**: Выбор противников или событий в зависимости от местности
- **Таблицы добычи**: Определение награды на основе уровня сложности или типа противника
- **Каскадные таблицы событий**: Многоуровневые события (погода → тип осадков → интенсивность)
- **Таблицы реакции NPC**: Определение реакции персонажей на действия игроков

### В компьютерных играх:
- **Системы генерации лута**: Вероятностное определение выпадающих предметов
- **Динамические события**: Случайные события, зависящие от характеристик игрока или локации
- **Проксимационные системы**: Выбор контента на основе параметров игрового мира

### В инструментах для Гейм-мастеров:
- **Автоматизация сложных бросков**: Быстрые броски по многоуровневым таблицам
- **Библиотеки таблиц**: Создание, обмен и повторное использование наборов таблиц
- **Динамические модификаторы**: Применение ситуационных модификаторов к броскам

### В системах, требующих детерминированного выбора:
- **Конфигурационные системы**: Выбор параметров на основе входных значений
- **Системы классификации**: Категоризация входных данных по диапазонам
- **Многоуровневые правила**: Применение правил, зависящих от предыдущих результатов

## Ограничения

### Функциональные ограничения:
- **Диапазонные ключи**: Поддержка только диапазонных ключей, без взвешенных вероятностей
- **Линейный поиск**: Поиск результата осуществляется линейным перебором ключей

### Архитектурные ограничения:
- **Зависимость от интерфейса Roller**: Требуется внешняя реализация генератора случайных чисел
- **Отсутствие потокобезопасности**: Не предназначен для конкурентного использования без внешней синхронизации
- **Детерминированный поиск**: Поиск осуществляется последовательной проверкой ключей

### Практические ограничения:
- **Оптимизация для небольших таблиц**: Пакет оптимизирован для таблиц с типичным для НРИ количеством записей (6-20)
- **Память для кэширования**: Хранение разобранных ключей в памяти для каждой таблицы
- **Ограниченная глубина каскада**: Максимальная глубина рекурсии 100 уровней для предотвращения бесконечных циклов

## Возможности расширения

### Легко расширяемые компоненты:

1. **Новые форматы ключей**:
   - Добавление поддержки регулярных выражений или сложных условий
   - Поддержка составных ключей (логические выражения)

2. **Дополнительные форматы сериализации**:
   - Поддержка XML, CSV или бинарных форматов
   - Кастомные сериализаторы через интерфейсы

3. **Расширенные возможности бросков**:
   - Поддержка многократных бросков за один вызов
   - Предсказуемые (детерминированные) броски для тестирования

4. **Интеграционные расширения**:
   - Адаптеры для популярных генераторов случайных чисел
   - Плагины для игровых движков
   - Веб-интерфейс для удалённого использования

## Заключение

Пакет `tttable` предоставляет специализированную, но гибкую инфраструктуру для работы с таблицами диапазонных ключей, характерных для настольных ролевых игр и подобных систем. Его архитектура делает упор на простоту использования, валидацию данных и поддержку сложных сценариев через каскадные ссылки, оставаясь при этом достаточно легковесным для интеграции в различные проекты.

Пакет идеально подходит для сценариев, где требуется детерминированный выбор на основе числовых входов с поддержкой диапазонов и каскадных ссылок, но не предназначен для систем, требующих сложных вероятностных распределений или высокопроизводительной обработки тысяч ключей.

Расширение функциональности пакета возможно через стандартные интерфейсы и паттерны, что позволяет адаптировать его к конкретным требованиям проекта без изменения ядра системы.