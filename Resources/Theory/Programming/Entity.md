---
updated_at: 2026-02-12T15:03:31.956+10:00
---
**Сущность** ({{Entity|entity}}) — это объект предметной области, обладающий непрерывной, сквозной [[Identity|идентичностью]], которая сохраняется на протяжении всего жизненного цикла и не зависит от состояния его атрибутов. Две сущности могут иметь полностью совпадающие поля, но считаться различными, если их идентификаторы различаются; напротив, изменение всех атрибутов сущности не меняет её тождественности.

В [[Domain-Driven Design|предметно-ориентированном проектировании]] сущности противопоставляются [[Value Object|объектам-значениям]], которые определяются исключительно своими свойствами.

### Назначение
Сущности являются фундаментальным элементом моделирования предметных областей, где важна индивидуальность объектов:

*   **Представление уникальных объектов**. Клиенты, заказы, счета, сотрудники — все эти понятия требуют различения отдельных экземпляров независимо от их текущего состояния.
*   **Поддержка изменяемости ([[Mutability|mutability]])**. В отличие от объектов-значений, сущности могут изменять свои атрибуты, оставаясь при тем же самым объектом; их состояние эволюционирует во времени.
*   **Обеспечение прослеживаемости**. Идентичность позволяет связывать события, произошедшие с объектом в разные моменты времени (аудит, история изменений, журналирование).
*   **Корни агрегатов ([[Aggregate Root|aggregate root]])**. В [[Aggregate|агрегатах]] именно сущность выступает корнем — единственной точкой доступа ко всем объектам внутри границы согласованности.

### Ограничения
Применение сущностей сопряжено с рядом объективных сложностей и ограничений:

1.  **Ответственность за идентичность**. Разработчик должен явно определить, что составляет идентичность сущности. Выбор естественного ключа (номера паспорта, email) или суррогатного идентификатора (UUID, автоинкремент) имеет далеко идущие последствия для производительности, распределённости и устойчивости к изменениям.
2.  **Управление жизненным циклом**. Сущности требуют создания, хранения, поиска и удаления; это влечёт необходимость [[Repository|репозиториев]] и инфраструктурного кода, отсутствующего у объектов-значений.
3.  **Ссылочная целостность**. В распределённых системах поддержание консистентных ссылок между сущностями, находящимися в разных [[Bounded Context|ограниченных контекстах]] или хранилищах, нетривиально и часто требует компромиссов.
4.  **Параллелизм и конкурентность**. Поскольку состояние сущности изменяется, необходимо управлять конкурентным доступом — оптимистической или пессимистической блокировкой, версионированием.
5.  **Склонность к разрастанию**. Сущности легко обрастают ответственностью, выходящей за пределы их естественных границ, превращаясь в «божественные объекты».

### Сложившиеся практики
Индустрия выработала устойчивый набор рекомендаций по проектированию и реализации сущностей:

1.  **Явное определение идентичности ([[Identity|identity]])**. Идентификатор сущности должен быть:
    *   стабильным — никогда не изменяется в течение жизни сущности;
    *   уникальным в пределах системы или контекста;
    *   независимым от изменяемых атрибутов.
    Предпочтительны суррогатные ключи (UUID, глобально уникальные идентификаторы), особенно в распределённых системах.

2.  **Переопределение равенства на основе идентичности**. Сущности считаются равными, только если их идентификаторы совпадают. Сравнение по содержимому полей недопустимо. Это контрастирует с объектами-значениями, где сравнение идёт по всем атрибутам.

3.  **Минимизация состояния**. Сущность должна содержать только те атрибуты, которые непосредственно относятся к её идентичности и поведению. Вспомогательные, вычисляемые или редко используемые данные могут выноситься в [[Value Object|объекты-значения]] или отдельные сервисы.

4.  **Богатое поведение ([[Rich Domain Model|rich domain model]])**. Сущность не является простым контейнером данных с геттерами и сеттерами; она инкапсулирует бизнес-логику и проверку инвариантов. Методы выражают операции, допустимые в предметной области (`отменитьЗаказ`, `изменитьАдрес`), а не технические манипуляции полями.

5.  **Единственная ответственность в рамках агрегата**. В составе [[Aggregate|агрегата]] только корневая сущность имеет глобальную идентичность и доступна извне. Внутренние сущности агрегата могут иметь локальную идентичность, различимую только внутри агрегата.

6.  **Использование репозиториев ([[Repository|repository]])**. Каждая корневая сущность имеет соответствующий репозиторий, инкапсулирующий логику сохранения, поиска и удаления. Репозитории предоставляют коллекционно-подобный интерфейс и скрывают детали хранения.

7.  **Оптимистическая блокировка**. Для обнаружения конфликтов параллельного изменения сущность снабжается версией (целочисленный счётчик или временная метка). При сохранении проверяется соответствие версии; при несовпадении генерируется исключение.

8.  **Разделение на [[Bounded Context|ограниченные контексты]]. Одна и та же сущность может иметь различные представления и даже различные идентификаторы в разных контекстах. Например, «Клиент» в контексте продаж и «Клиент» в контексте поддержки — разные сущности, связанные через трансляцию идентификаторов.

9.  **Тестирование изолированно**. Бизнес-логика сущности тестируется без инфраструктурных зависимостей (баз данных, репозиториев, внешних сервисов). Это достигается выделением чистого доменного кода, не содержащего ссылок на инфраструктуру.

10. **Событийность ([[Domain Event|domain events]])**. Значимые изменения состояния сущности порождают [[Domain Event|события предметной области]], которые могут быть использованы для оповещения других частей системы, аудита или событийного сторинга.

Таким образом, сущность является краеугольным камнем объектно-ориентированного моделирования предметной области. Её проектирование требует осознанного выбора идентификатора, дисциплины в инкапсуляции поведения и строгого соблюдения границ агрегатов. При правильном применении сущности делают модель выразительной, сохраняемой и способной отражать сложную динамику бизнес-процессов.