---
updated_at: 2026-02-16T13:24:05.037+10:00
---
**Ротация логов** ({{Log Rotation|log rotation}}) — это механизм автоматического управления файлами [[Log|логов]], предотвращающий их неограниченный рост. Процесс включает периодическое переименование текущего активного файла лога, создание нового пустого файла для продолжения записи, а также сжатие, архивирование и удаление устаревших файлов в соответствии с заданными политиками.

### Назначение
Ротация логов является обязательным компонентом эксплуатации программных систем и решает следующие задачи:

*   **Предотвращение исчерпания дискового пространства**. Без ротации даже умеренно интенсивная запись может за несколько дней или часов заполнить всю доступную ёмкость накопителя, что приведёт к отказам системы.
*   **Упрощение анализа и поиска**. Работа с относительно небольшими, хронологически упорядоченными файлами удобнее, чем с единым многогигабайтным файлом.
*   **Обеспечение политик хранения ([[Retention Policy|retention policy]])**. Автоматическое удаление или перенос в долговременное хранилище записей, превысивших установленный срок хранения.
*   **Снижение нагрузки на ввод-вывод**. Сжатие старых логов уменьшает занимаемое место и затраты на передачу при резервном копировании.
*   **Соответствие нормативным требованиям**. Фиксированные сроки хранения и неизменность архивных файлов могут требоваться законодательством.

### Ограничения
Применение ротации логов сопряжено с рядом практических ограничений:

1.  **Потенциальная потеря событий**. Если приложение удерживает открытый [[File Descriptor|файловый дескриптор]] удалённого или переименованного файла, запись может продолжиться в уже неактуальный файл или бесследно исчезнуть.
2.  **Задержки при ротации**. Операции переименования, сжатия и удаления крупных файлов создают кратковременную нагрузку на дисковую подсистему и могут временно блокировать запись.
3.  **Сложность восстановления последовательности**. При частой ротации большое количество мелких файлов может усложнить хронологический анализ по сравнению с единым потоком.
4.  **Конфликты прав доступа**. Ротация, выполняемая от одного пользователя (например, root), может создавать файлы с правами, не соответствующими правам процесса приложения.
5.  **Несовместимость с некоторыми приложениями**. Программы, не закрывающие файловые дескрипторы при сигналах или не переоткрывающие файл по сигналу, требуют специальных режимов ротации.

### Сложившиеся практики
Индустрия выработала устойчивый набор подходов к эффективной и безопасной ротации логов:

1.  **Использование специализированных утилит**. В Unix-подобных системах стандартом является **logrotate**, в Windows — встроенные средства или сторонние инструменты (например, NXLog). Утилиты настраиваются декларативно и запускаются по расписанию (через cron, планировщик задач).

2.  **Две основные стратегии ротации**:
    *   **[[Create|create]]** — текущий файл переименовывается (например, `app.log` → `app.log.1`), затем создаётся новый пустой файл с исходным именем. Приложение продолжает писать в новый файл по имени.
    *   **[[Copytruncate|copytruncate]]** — текущий файл копируется в архив, затем исходный файл усекается до нулевой длины. Приложение продолжает писать в тот же файловый дескриптор. Этот метод не требует перезапуска приложения, но существует риск потери записей, сделанных между копированием и усечением.

3.  **Сжатие ([[Compression|compression]])**. Старые файлы логов сжимаются (обычно gzip, zstd) для экономии места. Сжатие выполняется либо сразу после ротации, либо асинхронно фоновым процессом.

4.  **Уведомление приложений ([[Signal|signal]])**. При использовании стратегии `create` приложение должно получить сигнал (например, SIGHUP, SIGUSR1) для переоткрытия файлового дескриптора. В конфигурации logrotate это задаётся директивой `postrotate` с отправкой соответствующего сигнала процессу.

5.  **Политики ротации**. Выбор критерия запуска ротации:
    *   **по размеру** (`size`) — ротация при достижении файлом определённого объёма;
    *   **по времени** (`daily`, `weekly`, `monthly`) — ротация через фиксированные интервалы;
    *   **комбинированные** — ротация по первому достигнутому условию.

6.  **Управление ретенцией ([[Retention|retention]])**. Определяется максимальное количество хранимых архивных файлов (директива `rotate` в logrotate) или максимальный срок хранения. Старые файлы автоматически удаляются.

7.  **Централизованное логирование как альтернатива ([[Centralized Logging|centralized logging]])**. В современных распределённых системах приложения направляют логи в стандартный вывод (stdout), а сбор и ротация делегируются инфраструктурным компонентам (Docker, systemd, Kubernetes) или внешним агентам, которые передают данные в централизованное хранилище без создания локальных файлов.

8.  **Тестирование конфигурации ротации**. Настройки ротации проверяются в изолированной среде для исключения ошибок, приводящих к потере данных или неожиданному поведению.

9.  **Мониторинг процесса ротации**. Успешность выполнения ротации отслеживается: наличие свежих архивов, отсутствие ошибок в журналах самого инструмента ротации, свободное место на диске.

10. **Раздельное хранение по категориям**. Разные типы логов (доступ, ошибки, аудит) могут ротироваться с различными политиками, с учётом их ценности и объёма.

Таким образом, ротация логов является базовым, критически важным механизмом поддержания работоспособности систем, сохраняющих журналы в локальной файловой системе. Дисциплинированное применение описанных практик — выбор стратегии, настройка уведомлений приложений, определение политик размера и времени, а также регулярный мониторинг — позволяет предотвратить потерю данных и отказы, связанные с переполнением диска, при сохранении приемлемых затрат на хранение.