---
updated_at: 2025-12-12T15:48:16.916+10:00
tags:
  - part3
  - chapter12
---
В этой главе будет сделан перерыв в рассмотрении паттернов и техник проектирования, и все внимание сосредоточится на несложном процессе моделирования под названием `EventStorming`. Этот процесс объединяет основные аспекты предметно-ориентированного проектирования, рассмотренные в предыдущих главах.

Будет рассмотрен порядок организации и процесс проведения `EventStorming` для эффективного обмена знаниями о предметной области и создания единого языка (`ubiquitous language`).

## Что такое `EventStorming`?

`EventStorming` представляет собой технологически простой способ собрать вместе людей с целью быстрого моделирования бизнес-процесса с помощью техники мозгового штурма. В некотором смысле `EventStorming` является тактическим инструментом для обмена знаниями в области бизнеса.

У конкретной сессии `EventStorming` всегда заданы рамки исследования: бизнес-процесс, в изучении которого заинтересована группа специалистов. Участники исследуют процесс как последовательность событий предметной области, представленных стикерами на временной шкале. Шаг за шагом модель дополняется новыми понятиями — действующими лицами (`actor`), командами (`command`), внешними системами (`external system`) и другими — до тех пор, пока все ее элементы не раскроют историю хода всего бизнес-процесса.

## Кто принимает участие в `EventStorming`?

> Надо понимать, что цель `EventStorming` — узнать как можно больше в кратчайшие сроки. Мы приглашаем ключевых специалистов и не хотим впустую тратить их драгоценное время. – Альберто Брандолини (`Alberto Brandolini`), создатель `EventStorming`

В идеале в `EventStorming` должна участвовать разнородная группа специалистов. Фактически участвовать могут все, имеющие отношение к рассматриваемой предметной области: инженеры, эксперты в предметной области, владельцы продуктов, тестировщики, `UI/UX`-проектировщики, техническая поддержка и т. д. Чем больше людей с разным опытом будет вовлечено, тем больше знаний будет выявлено.

Но не нужно делать группу участников слишком большой. У каждого участника должна быть возможность внести свой вклад в процесс, но для групп свыше 10 участников это может быть затруднительно.

## Что нужно для проведения `EventStorming`?

`EventStorming` считается технологически простой практикой, поскольку он проводится с использованием маркеров и стикеров, очень большого количества стикеров. Давайте посмотрим, что нужно для проведения `EventStorming`:

*   **Свободное пространство**  
    В первую очередь следует озаботиться большим пространством для моделирования. Лучше всего, судя по изображению на рис. 12.1, для этого подойдет стена, с прикрепленной к ней рулонной бумагой. Может также подойти и большая белая доска, но она должна быть как можно больше, поскольку для моделирования будет задействована вся ее площадь. Рис. 12.1. Пространство моделирования для проведения `EventStorming`

![[Рис. 12.1. Пространство моделирования для проведения EventStorming.png]]

*   **Стикеры**  
    Далее понадобится множество стикеров разного цвета. Они будут использоваться для представления различных концепций предметной области, и каждый участник должен будет иметь возможность беспрепятственно их добавлять, поэтому следует заранее удостовериться в наличии достаточного числа стикеров нужных цветов для всех участников. Цвета, традиционно используемые для `EventStorming`, рассматриваются в следующем разделе. Лучше придерживаться рассматриваемых соглашений, дабы соответствовать всем доступным в настоящее время книгам и тренингам по `EventStorming`.

*   **Маркеры**  
    Также понадобятся маркеры, которыми можно будет делать надписи на стикерах. Опять же, расходные материалы не должны стать узким местом при обмене знаниями — маркеров должно хватать всем участникам.

*   **Закуски**  
    Типичный `EventStorming` длится от двух до четырех часов, поэтому для восполнения энергии следует взять с собой легкие закуски.

*   **Зал**  
    И наконец, для проведения `EventStorming` понадобится просторный зал. Убедитесь, что посередине нет огромного стола, который будет мешать участникам свободно перемещаться и наблюдать за ходом моделирования. Кроме того, стулья тоже будут мешать процессу. Нужно, чтобы специалисты принимали в нем активное участие и делились знаниями, а не сидели в углу с отрешенным видом. Поэтому по возможности стулья нужно вынести из зала.

## Процесс проведения `EventStorming`

`EventStorming` обычно проводится в 10 этапов. На каждом этапе модель обогащается дополнительной информацией и концепциями.

### Этап 1: Проведение неструктурированного исследования

`EventStorming` начинается с мозгового штурма по выявлению событий предметной области, связанных с исследуемой предметной областью. К событиям предметной области относится все интересное, происходящее в предметной области. События предметной области важно формулировать в прошедшем времени (см. рис. 12.2) — ими описывается то, что уже произошло. 

![[Рис. 12.2. Неструктурированное исследование.png]]

На этом этапе все участники берут пачку оранжевых стикеров, записывают любые события предметной области, которые приходят им на ум, и прикрепляют их к пространству для моделирования.

На этой ранней стадии не следует беспокоиться об упорядочении событий или даже об их некоторой избыточности. Этот этап посвящен мозговому штурму по вопросу всего, что может произойти в предметной области.

Группа специалистов должна продолжать выявление событий предметной области до тех пор, пока скорость добавления новых событий не дойдет до существенного снижения.

### Этап 2: Выстраивание в хронологическом порядке

Затем участники просматривают выявленные события предметной области и выстраивают их в порядке происхождения в предметной области.

События должны начинаться с «успешного сценария» (`happy path`): потока событий, описывающих успешный бизнес-сценарий.

После того как «успешный путь» пройден, можно приступить к добавлению альтернативных сценариев — например, путей, на которых встречаются ошибки или принимаются другие бизнес-решения. Как показано на рис. 12.3, ветвление потока может быть выражено двумя направлениями, исходящими от предшествующего события, или стрелками, нарисованными на пространстве моделирования.

![[Рис. 12.3. Потоки событий.png]]

На этом же этапе можно исправить некорректные события, удалить дубликаты и, конечно же, при необходимости добавить отсутствующие события.

### Этап 3: Проблемные места (`pain points`)

После выстраивания событий в хронологическом порядке, взгляните на них шире, чтобы определить те места в процессе, которые требуют особого внимания. Это могут быть какие-то узкие места, действия, требующие вмешательства человека или же требующие автоматизации, отсутствующая документация или же недостающие знания предметной области.

Важно выявить все недостатки, чтобы к ним можно было легко вернуться позже. Проблемные места, как показано на рис. 12.4, отмечаются повернутыми на 45 градусов (наклеенными в виде ромбов) розовыми стикерами. 

![[Рис. 12.4. Розовый ромбовидный стикер.png]]

Конечно, этот этап — не единственная возможность выявления проблемных мест. Организатор должен отслеживать комментарии участников на протяжении всего процесса. Когда поднимаются вопросы или вырисовываются проблемы, они должны быть отражены на соответствующем розовом стикере.

### Этап 4: Выявление ключевых событий (`pivotal events`)

Когда события выстроены в хронологическом порядке с указанием проблемных мест (`pain points`), следует выявить значимые бизнес-события, указывающие на изменение контекста или окончание одного из этапов. Они называются ключевыми/поворотными событиями (`pivotal events`) и отмечаются вертикальной чертой, разделяющей события до и после ключевого события.

Например, как показано на рис. 12.5, существенные изменения в процессе оформления заказа представляют собой события «Корзина покупок инициализирована», «Заказ инициализирован», «Заказ отправлен», «Заказ доставлен» и «Заказ возвращен».

Ключевые события являются индикатором потенциальных границ ограниченных контекстов.

![[Рис. 12.5. Ключевые события, обозначающие изменения контекста в потоке событий.png]]

### Этап 5: Выявление команд (`commands`)

В отличие от событий предметной области, описывающих что-то уже произошедшее, команда описывает то, что вызвало событие или поток событий. Команды описывают действия системы, которые, в отличие от событий предметной области, формулируются в повелительном наклонении. Например:

*   Опубликовать кампанию.
*   Откатить транзакцию.
*   Подтвердить заказ.

Команды записываются на светло-голубых стикерах и помещаются в пространстве моделирования перед событиями, которые они могут вызвать. Если конкретная команда выполняется действующим лицом (`actor`) в определенной роли, то, как показано на рис. 12.6, информация о действующем лице (`actor`) размещается на маленьком желтом стикере перед соответствующей командой. Действующее лицо представляет собой портрет пользователя (`persona`) в исследуемой предметной области, например клиента, администратора или редактора. Рис. 12.6. Команда «Отправить заказ», выполняемая заказчиком (действующее лицо) и сопровождаемая событиями «Заказ инициализирован», «Стоимость доставки рассчитана» и «Заказ отправлен»

![[Рис. 12.6. Команда «Отправить заказ», выполняемая заказчиком.png]]

Естественно, не все команды будут иметь ассоциированное с ними действующее лицо. Поэтому информацию о нем следует добавлять только там, где он очевиден.

На следующем этапе модель будет дополнена другими объектами, способными запускать команды.

### Этап 6: Выявление правил (`policies`)

Практически всегда в модель добавляется ряд команд, не связанных с конкретным действующим лицом (`actor`). На данном этапе происходит выявление правил автоматизации, способных выполнять такие команды.

Правило автоматизации — это сценарий, в котором событие запускает выполнение команды. Иными словами, команда автоматически выполняется, когда происходит определенное событие предметной области.

Как показано на примере стикера «Правило» на рис. 12.7, правила на пространстве моделирования представлены в виде лиловых стикеров, соединяющих события с командами. 

![[Рис. 12.7. Правило автоматизации, запускающее команду «Отправить заказ» при наступлении события «Отправка одобрена».png]]

Если рассматриваемая команда должна запускаться только при соблюдении некоторых критериев принятия решения, эти критерии можно указать явным образом на стикере с правилом (`policy`). Например, если нужно инициировать команду `escalate` после события «Получена жалоба», но только если жалоба была получена от `VIP`-клиента, условие «Только для `VIP`-клиентов» можно явно указать на стикере правила.

Если события и команды находятся далеко друг от друга, на пространстве моделирования можно нарисовать соединяющую их стрелку.

### Этап 7: Выявление моделей чтения (`read model`)

Модель чтения — это представление данных в предметной области, которое действующее лицо использует для принятия решения о выполнении команды. Это может быть один из экранов системы, отчет, уведомление и т. д.

Модели чтения представляются зелеными стикерами (см. стикер «Корзина» на рис. 12.8) с кратким описанием источника информации, необходимой для обоснования решения действующего лица (`actor`). Поскольку команда выполняется после того, как действующее лицо просмотрит модель чтения, модели чтения располагаются перед командами. 

![[Рис. 12.8. Вид «Корзины» (модели чтения.png]]

### Этап 8: Выявление внешних систем (`external systems`)

Этот этап посвящен дополнению модели внешними системами. Внешней считается любая система, не являющаяся частьми исследуемой предметной области. Она может выполнять команды (что считается вводом) или получать уведомления о событиях (что считается выводом).

Внешние системы представлены розовыми стикерами. На рис. 12.9 система управления информацией о клиентах — `CRM` (внешняя система) инициирует выполнение команды «Отправить заказ». Когда отправка подтверждена (событие), об этом сообщается в `CRM` (внешняя система) через правило (`policy`). Рис. 12.9. Внешняя система запускает выполнение команды (слева), и внешняя система получает уведомление с подтверждением отправки (справа)

К концу этого этапа все команды должны либо выполняться действующими лицами (`actor`), либо инициироваться правилами (`policy`), либо вызываться внешними системами (`external system`).

![[Рис. 12.9. Внешняя система.png]]

### Этап 9: Выявление агрегатов

Когда все события и команды представлены на пространстве моделирования, участники могут приступать к обдумыванию порядка объединения связанных концепций в агрегаты. Агрегат получает команды и порождает события.

Агрегаты, как показано на рис. 12.10, представлены в виде больших желтых стикеров с командами слева и событиями справа. 

![[Рис. 12.10. Команды и события предметной области, собранные в агрегат.png]]

### Этап 10: Выявление ограниченных контекстов

Последним этапом `EventStorming` является поиск агрегатов, относящихся друг к другу либо по причине представления тесно связанных функций, либо по причине их связывания каким-то из правил (`policy`). Группы агрегатов, как показано на рис. 12.11, образуют естественных кандидатов на границы ограниченных контекстов.

![[Рис. 12.11. Возможное разбиение полученной системы на ограниченные контексты.png]]

## Варианты

Альберто Брандолини, создатель `EventStorming`, определяет процесс `EventStorming` как руководство, а не как набор жестких правил. С процессом проведения можно поэкспериментировать, чтобы найти тот самый «рецепт», который подойдет вам больше всего.

Согласно моему опыту процесс проведения `EventStorming` в организации я предпочитаю начинать с изучения общей картины предметной области, выполняя шаги с 1-го (неструктурированное исследование) по 4-й (выявление ключевых событий (`pivotal events`)). Полученная модель охватывает широкий спектр предметной области компании, создает прочную основу для единых языков (`ubiquitous language`) и определяет возможные границы ограниченных контекстов (`bounded context`).

Получив общую картину и идентифицировав различные бизнес-процессы, проводится отдельная сессия для каждого бизнес-процесса — на этот раз четко следуя всем этапам, чтобы смоделировать весь процесс.

В конце полного сеанса `EventStorming` будет получена модель, описывающая события предметной области (`domain events`), команды (`commands`), агрегаты (`aggregate`) и даже возможные ограниченные контексты (`bounded contexts`). Впрочем, все это лишь приятные бонусы. Настоящая ценность `EventStorming` заключается в самом процессе — обмене знаниями между различными заинтересованными сторонами, согласовании их ментальных моделей, обнаружении конфликтующих моделей и, что не менее важно, формулировании единого языка (`ubiquitous language`).

Получающаяся в результате модель может быть принята в качестве основы для реализации модели предметной области, основанной на событиях. Решение о том, нужно идти по этому пути или же нет, зависит от сферы вашего бизнеса. Если будет принято решение о реализации модели предметной области, основанной на событиях (`event sourced domain model`), вы будете располагать границами ограниченных контекстов, агрегатами и, конечно же, наметками необходимых событий предметной области.

## Когда следует проводить `EventStorming`

`EventStorming` может проводиться по многим причинам:

*   **С целью выработки единого языка (`ubiquitous language`)**  
    При сотрудничестве групп в построении модели бизнес-процесса они естественным образом синхронизируют терминологию и начинают применять один и тот же язык.
*   **С целью моделирования бизнес-процесса**  
    `EventStorming` — эффективный способ построения модели бизнес-процесса. Так как в его основе лежит выявление строительных блоков по `DDD`-методике, он также является эффективным способом обнаружения границ агрегатов и ограниченных контекстов.
*   **С целью изучения новых бизнес-требований**  
    `EventStorming` можно воспользоваться, чтобы убедиться в единстве взглядов всех участников на новые функции и выявить граничные случаи, не охватываемые бизнес-требованиями.
*   **С целью восстановления знаний предметной области**  
    Со временем знание предметной области может утратиться. Особенно остро это проявляется в отношении унаследованных систем, требующих модернизации. `EventStorming` является эффективным способом объединения знаний, которыми обладает каждый участник, в единую связную картину.
*   **С целью исследования способов улучшения существующего бизнес-процесса**  
    Проведение сквозного анализа бизнес-процесса дает представление, необходимое для выявления неэффективных сторон и возможностей для улучшения процесса.
*   **С целью приема в команду новых сотрудников**  
    Проведение `EventStorming` с участием новых сотрудников — отличный способ расширения знаний предметной области.

В дополнение к причинам проведения `EventStorming`, важно указать причины, по которым его не следует проводить. Проведение `EventStorming` будет менее успешным, если изучаемый бизнес-процесс прост или вполне очевиден, например заключается в выполнении ряда последовательных шагов без какой-либо интересной бизнес-логики или сложности.

## Советы по проведению

При проведении `EventStorming` с группой специалистов, ранее никогда не участвующих в `EventStorming`, я считаю, что сначала лучше дать краткий обзор всего процесса. В ходе обзора объясняются предстоящие действия участников, суть намеченного к изучению бизнес-процесса и элементы моделирования, используемые в ходе семинара. По мере объяснения элементов моделирования — событий предметной области (`domain events`), команд (`commands`), действующих лиц (`actors`) и т. д., чтобы помочь участникам запомнить цветовую маркировку, на пространстве моделирования выкладываются все условные обозначения, показанные на рис. 12.12, в виде применяемых в дальнейшем стикеров. В ходе семинара условные обозначения должны быть видны всем его участникам. Рис. 12.12. Условные обозначения различных элементов процесса `EventStorming`, выполненные в виде надписей на соответствующих стикерах

![[Рис. 12.12. Условные обозначения различных элементов процесса EventStorming.png]]
### Отслеживание динамики проведения семинара

По ходу семинара важно отслеживать активность группы. Если динамика процесса замедляется, нужно понять, можно ли активизировать процесс, задавая различные вопросы, или же пора переходить к следующему этапу.

Следует помнить, что `EventStorming` — коллективное мероприятие, поэтому нужно убедиться, что оно таковым и является. Убедитесь, что у каждого специалиста имеется возможность поучаствовать в моделировании и обсуждении. Если заметите, что некоторые участники отделяются от коллектива, попробуйте вовлечь их в процесс, задавая вопросы о текущем состоянии модели.

`EventStorming` предполагает интенсивные размышления участников, и в какой-то момент группе понадобится перерыв. Не возобновляйте сеанс, пока все участники не вернутся в зал. Возобновите процесс с обзора текущего состояния модели, чтобы вернуть группу в атмосферу совместного моделирования.

## Проведение `EventStorming` с удаленными участниками

`EventStorming` был придуман как технологически простой вид деятельности, предусматривающий общение специалистов и их совместное обучение в пределах одного помещения. Создатель `EventStorming` Альберто Брандолини часто высказывался против удаленного проведения, поскольку, когда группа находится в разных местах, достичь такого же уровня участия и, следовательно, сотрудничества и обмена знаниями невозможно.

Но с началом пандемии `COVID-19` в 2020 году проведение личных встреч и `EventStorming` предполагаемым ранее способом стало невозможно. Для обеспечения совместной работы и упрощения проведения удаленных сеансов `EventStorming` был испробован целый ряд инструментов. На момент написания книги наиболее заметным из них стал `miro.com`. При проведении `EventStorming` в режиме онлайн следует проявлять особое терпение и принимать во внимание снижение эффективности общения.

Кроме того, мой опыт показывает, что удаленные сеансы `EventStorming` более эффективны при меньшем количестве участников. Если на обычном семинаре `EventStorming` могут присутствовать до 10 человек, то онлайн-сеансы я предпочитаю ограничивать пятью участниками. Когда для обмена знаниями требуется большее количество участников, можно провести несколько сеансов, а затем сравнить и объединить полученные модели.

А как только позволит ситуация, нужно будет вернуться к `EventStorming` с личным присутствием участников.

## Вывод

`EventStorming` — это семинар, проводимый для совместной работы по моделированию бизнес-процессов. Помимо полученных в результате его проведения моделей, его основным преимуществом является обмен знаниями. К концу сессии все участники синхронизируют свои ментальные модели в понимании бизнес-процесса и приобретут первый опыт использования единого языка (`ubiquitous language`).

`EventStorming` подобен езде на велосипеде. Гораздо проще научиться делать это, чем читать об этом в книге. К тому же он проводится в легкой и непринужденной манере. Чтобы его иницировать, не нужно быть каким-то гуру. Просто организуйте его, следуйте инструкциям и учитесь руководить процессом в ходе его проведения.








