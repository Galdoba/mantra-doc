---
updated_at: 2025-12-12T15:26:14.680+10:00
tags:
  - part3
  - chapter11
---
В нашем столь стремительно меняющемся мире компании не могут позволить себе ни малейшей пассивности. Чтобы не отстать от конкурентов, им приходится постоянно меняться, развиваться и даже с течением времени заново «изобретать самих себя». Этот факт невозможно игнорировать при проектировании систем, особенно если планировать разработку программных средств, плотно адаптированных к требованиям их предметной области. Когда изменения не контролируются в должной мере, даже самый изящный и продуманный дизайн в конечном итоге становится кошмаром для тех, кто занимается его сопровождением и развитием. В этой главе рассматриваются вопросы влияния изменений в окружающей среде программного проекта на проектные решения и задачи соответствующей эволюции проекта.

В поле зрения попадут четыре наиболее распространенных вектора изменений: предметная область, организационная структура, знание предметной области и рост проекта.

## Изменения в предметных областях

Из главы 2 известно о трех типах поддоменов и их отличиях друг от друга:

*   **Основной (`core`)**: Деятельность компании, отличающаяся от деятельности ее конкурентов с целью получения конкурентных преимуществ.
*   **Вспомогательный (`supporting`)**: То, что компания делает иначе, чем ее конкуренты, но не обеспечивает конкурентных преимуществ.
*   **Универсальный (`generic`)**: То, что все компании делают одинаково.

Из предыдущих глав стало понятно, что тип используемого поддомена влияет на стратегические и тактические проектные решения:

*   Как спроектировать границы ограниченных контекстов.
*   Как организовать интеграцию контекстов.
*   Какие паттерны (`pattern`) проектирования следует использовать с учетом сложности бизнес-логики.

Для разработки программного продукта, ориентированного на потребности предметной области, весьма важно определить поддомены и их типы. Но это еще не все. Не менее важно проследить эволюцию поддоменов. По мере роста и развития организации нередко случается так, что некоторые из ее поддоменов трансформируются из одного типа в другой. Рассмотрим несколько примеров таких изменений.

### Из основного в универсальный

Представьте, что интернет-компания розничной торговли `BuyIT` внедряет собственное решение по доставке заказов. Она разработала инновационный алгоритм для оптимизации маршрутов своей курьерской доставки и, таким образом, может взимать более низкую плату за доставку, чем ее конкуренты.

Но со временем другая компания — `DeliveryIT` — вносит изменения в сам процесс доставки. Она утверждает, что решила задачу «коммивояжера» и предлагает в качестве услуги оптимизацию пути доставки. Оптимизация, предлагаемая компанией `DeliverIT`, не только более совершенна, но и обходится дешевле затрат компании `BuyIT` на выполнение той же задачи.

С позиции `BuyIT`, как только решение `DeliverIT` стало доступным в виде готового продукта, его основная подобласть превратилась в универсальную. В результате оптимальное решение по доставке стало доступно всем конкурентам `BuyIT`. Без крупных инвестиций в исследования и разработку `BuyIT` больше не сможет получить конкурентное преимущество в подобласти оптимизации пути. То, что ранее считалось конкурентным преимуществом `BuyIT`, стало товаром, доступным для всех ее конкурентов.

### Из универсального в основной

С момента своего создания компания `BuyIT` использует готовое решение для управления своими запасами. Но отчеты бизнес-аналитики постоянно показывают неадекватные прогнозы потребностей клиентов. Следовательно, `BuyIT` не может пополнить свои запасы самых популярных продуктов и забивает склады непопулярными продуктами. Оценив ряд альтернативных решений по управлению запасами, руководство `BuyIT` принимает стратегическое решение инвестировать в разработку и создание собственной системы. Это внутреннее решение будет учитывать особенности продуктов, продаваемых `BuyIT`, и более качественно прогнозировать потребности клиентов.

Решение `BuyIT` заменить готовое решение собственной реализацией превратило управление запасами из универсального поддомена в основной: успешная реализация задуманной функциональности даст `BuyIT` дополнительное конкурентное преимущество перед другими компаниями — конкуренты «застрянут» на общем решении и не смогут воспользоваться передовым алгоритмам прогнозирования спроса, изобретенным и разработанным компанией `BuyIT`.

Примером из реальной жизни компании, превращающей универсальный поддомен в основной, является `Amazon`. Как и всем поставщикам услуг, компании `Amazon` требовалась инфраструктура для работы своих сервисов. Компания смогла «заново изобрести» способ управления своей физической инфраструктурой, а позже даже превратила его в прибыльный бизнес: `Amazon Web Services`.

### Из вспомогательного в универсальный

Отдел маркетинга компании `BuyIT` внедряет систему управления своими поставщиками и их контрактами. В системе нет ничего особенного или сложного — это просто некие `CRUD`-интерфейсы для ввода данных. Иными словами, это типичный вспомогательный поддомен.

Но по прошествии нескольких лет от начала внедрения компанией `BuyIT` собственного решения появилось решение для управления контрактами с открытым исходным кодом. В соответствующем проекте реализовывалась та же функциональность, что и в существующем решении, но имелись более совершенные функции, такие как `OCR` и полнотекстовый поиск. Эти функции долгое время находились в `BuyIT` в списке намеченных работ, но им никогда не уделялось первоочередного внимания из-за их незначительного влияния на бизнес. Итак, компания решает отказаться от внутренней разработки в пользу интеграции решения с открытым исходным кодом. При этом поддомен управления документами из вспомогательного превращается в универсальный.

### Из вспомогательного в основной

Вспомогательный поддомен также может превратиться в основной, например, если компания найдет способ оптимизировать вспомогательную логику таким образом, чтобы это либо снизило затраты, либо принесло дополнительную прибыль.

Типичным признаком подобного преобразования является возрастающая сложность бизнес-логики вспомогательного поддомена. Сами по себе вспомогательные поддомены по определению просты и в основном напоминают `CRUD`-интерфейсы или же `ETL`-процессы. Но если бизнес-логика со временем усложняется, для этого должна быть вполне определенная причина. Если изменения не влияют на прибыль компании, то зачем все усложнять? Это будет ничем не обоснованное усложнение бизнеса. С другой стороны, если изменения повышают прибыльность компании, то это уже признак того, что вспомогательный поддомен становится основным.

### Из основного во вспомогательный

Основной поддомен может со временем стать вспомогательным. Это может произойти при ничем не оправданной сложности подобласти. Иными словами, если от сложности нет никакой выгоды, тогда организация может решить избавиться от лишней сложности, оставив минимум логики, необходимой для поддержки реализации других поддоменов.

### Из универсального во вспомогательный

И наконец, по той же причине, что и в случае с основным поддоменом, универсальный поддомен может превратиться во вспомогательный. Возвращаясь к примеру с системой управления документами `BuyIT`, предположим, что компания решила, что сложность интеграции решения с открытым исходным кодом не оправдывается получаемыми при этом преимуществами, и вернулась к собственной системе. В результате универсальный поддомен превратился во вспомогательный.

Только что рассмотренные изменения в подобластях показаны на рис. 11.1.

![[Рис. 11.1. Факторы изменения типов поддоменов.png]]

## Стратегические аспекты проектирования

Изменение типа поддомена напрямую влияет на его ограниченный контекст и, следовательно, на соответствующие стратегические проектные решения. Как известно из главы 4, для разных типов подобластей подходят разные паттерны интеграции ограниченного контекста. Основные поддомены должны защищать свои модели с помощью предохранительного слоя (`anticorruption layer`) и защищать потребителей от частых изменений в моделях реализации с помощью сервиса с открытым протоколом (`open-host service`).

Другим паттерном интеграции, на который влияют изменения типов, является паттерн разных путей (`separate ways`). Как выяснилось ранее, команды могут воспользоваться этим паттерном для вспомогательных и универсальных поддоменов. Если поддомен превращается в основной, дублирование его функций несколькими командами становится неприемлемым. Следовательно, у команд нет другого выбора, кроме как интегрировать свои реализации. В этом случае наибольший смысл будут иметь отношения типа потребитель-поставщик (`customer-supplier`), поскольку основной поддомен будет реализован только одной командой.

С точки зрения стратегии реализации основные и вспомогательные поддомены различаются по способу их реализации. Вспомогательные поддомены можно передать на аутсорсинг или использовать в качестве тренажера для новых сотрудников. Основные поддомены должны быть реализованы внутри компании, как можно ближе к источникам знаний о предметной области. Поэтому, когда вспомогательный поддомен превращается в основной, его реализацию следует перенести в компанию. Та же логика работает и в обратную сторону. Если основной поддомен превращается во вспомогательный, его реализацию можно передать на аутсорсинг, чтобы позволить внутренним группам исследований и разработок сосредоточиться на основных поддоменах.

## Тактические аспекты проектирования

Основным показателем изменения типа поддомена является неспособность существующего технического дизайна поддерживать текущие потребности бизнеса. Вернемся к примеру вспомогательного поддомена, ставшего основным. Вспомогательные поддомены реализуются с помощью относительно простых паттернов проектирования, используемых для моделирования бизнес-логики: транзакционный сценарий (`transaction script`) или паттерн активной записи (`active record`). Как известно из главы 5, эти паттерны плохо подходят для бизнес-логики, включающей сложные правила и инварианты.

Если со временем к бизнес-логике добавляются сложные правила и инварианты, кодовая база также будет усложняться. Добавлять новый функционал будет слишком проблематично, поскольку дизайн не поддержит новый уровень сложности. Эта «проблематичность» станет важным сигналом. Воспользуйтесь им как призывом к переоценке предметной области и вариантов дизайна.

Необходимости изменения стратегии реализации не нужно бояться. Это нормально. Мы не всегда можем предвидеть дальнейшее развитие бизнеса. Мы также не можем применять самые сложные паттерны проектирования для всех типов поддоменов: это было бы расточительно и неэффективно. Нужно выбрать наиболее подходящий дизайн и развивать его по мере необходимости.

Если решение о том, как моделировать бизнес-логику, принимается осознанно, и известны все возможные варианты дизайна, а также различия между ними, переход от одного паттерна проектирования к другому не будет таким трудным. Соответствующие примеры рассмотрены в следующих подразделах.

### Преобразование транзакционного сценария в активную запись

По своей сути и транзакционный сценарий, и паттерн «Активная запись» основаны на одном и том же принципе: бизнес-логика реализована в виде процедурного сценария. Разница между ними заключается в том, как моделируются структуры данных: паттерн «Активная запись» вводит структуры данных с целью инкапсуляции сложности их сопоставления с механизмом хранения.

В связи с этим, когда работа с данными в транзакционном сценарии усложняется, его следует реорганизовать в шаблон активной записи. Ищите сложные структуры данных и инкапсулируйте их в объекты паттерна «Активная запись». Вместо прямого доступа к базе данных используйте паттерн «Активная запись» для абстрагирования ее модели и структуры.

### Преобразование активной записи в модель предметной области

Если бизнес-логика, манипулирующая активными записями, становится сложной и отмечается все больше случаев несоответствий и дублирования, реализацию следует преобразовать в паттерн модели предметной области (`domain model`).

Начните с определения объектов-значений (`value-objects`). Ответьте на вопрос: какие структуры данных можно смоделировать как неизменяемые объекты? Найдите соответствующую бизнес-логику и сделайте ее частью объектов-значений.

Затем проанализируйте структуры данных и найдите границы транзакций. Чтобы убедиться, что вся логика изменения состояния является явной, сделайте все функции задания значений активных записей закрытыми, чтобы значения можно было изменять только изнутри самой активной записи. Понятно, что компиляция даст сбой, но ошибки компиляции прояснят, где именно находится логика, изменяющая состояние. Преобразуйте эту логику в границы активной записи. Например:

```java
public class Player
{
 public Guid Id { get; set; }
 public int Points { get; set; }
}

public class ApplyBonus
{
 ...
 public void Execute(Guid playerId, byte percentage)
 {
   var player = _repository.Load(playerId);
   player.Points *= 1 + percentage/100.0;
   _repository.Save(player);
 }
}
```

В следующем коде можно увидеть первые шаги к преобразованию. Код пока не скомпилируется, но ошибки выявят, где именно внешние компоненты контролируют состояние объекта:

```java
public class Player
{
 public Guid Id { get; private set; }
 public int Points { get; private set; }
}

public class ApplyBonus
{
 ... 
 public void Execute(Guid playerId, byte percentage)
 {
   var player = _repository.Load(playerId);
   player.Points *= 1 + percentage/100.0;
   _repository.Save(player);
 }
}
```

На следующем шаге можно переместить эту логику внутрь границы активной записи:

```java
public class Player
{
 public Guid Id { get; private set; }
 public int Points { get; private set; }
 public void ApplyBonus(int percentage)
 {
   this.Points *= 1 + percentage/100.0;
 }
}
```

Когда вся бизнес-логика, изменяющая состояние, перемещена в границы соответствующих объектов, проверьте, какие иерархии необходимы для обеспечения строго согласованной проверки бизнес-правил и инвариантов. Они являются хорошими кандидатами на агрегаты. Помня о принципах построения агрегатов, рассмотренных в главе 6, ищите наименьшие границы транзакций, т. е. наименьшее количество данных, необходимое для обеспечения строгой согласованности. Разложите иерархии вдоль этих границ. Убедитесь, что ссылки на внешние агрегаты идут только по их идентификаторам.

В завершение определите для каждого агрегата его корень или точку входа для его публичного интерфейса. Сделайте методы всех других внутренних объектов в агрегате закрытыми и вызываемыми только из агрегата.

### Преобразование модели предметной области в модель предметной области, основанную на событиях

Когда есть модель предметной области с правильно спроектированными границами агрегатов, ее можно преобразовать в модель, основанную на событиях (`event sourced domain model`). Вместо прямого изменения данных агрегата смоделируйте события предметной области, необходимые для представления жизненного цикла агрегата.

Наиболее сложным аспектом преобразования модели предметной области в модель предметной области, основанную на событиях, является история существующих агрегатов: миграция «безвременного» состояния в модель, основанную на событиях. Поскольку подробных данных, представляющих все прошлые изменения состояния, нет, нужно либо сгенерировать прошлые события по мере возможности, либо смоделировать события миграции.

## Генерация прошлых переходов состояния

Этот подход влечет за собой создание приблизительного потока событий для каждого агрегата, чтобы этот поток можно было спроецировать в то же представление состояния, что и в исходной реализации. Рассмотрим пример, показанный в главе 7 и представленный в табл. 11.1.

![[Таблица 11.1. Представление данных агрегата на основе состояния.png]]

С точки зрения бизнес-логики можно предположить, что экземпляр агрегата был инициализирован, затем с человеком связались, оформили заказ и, наконец, поскольку статус был «преобразован» («converted»), оплата заказа была подтверждена. Все эти переходы состояния могут быть представлены следующим набором событий:

```json
{
 "lead-id": 12,
 "event-id": 0,
 "event-type": "lead-initialized",
 "first-name": "Shauna",
 "last-name": "Mercia",
 "phone-number": "555-4753"
},
{
 "lead-id": 12,
 "event-id": 1,
 "event-type": "contacted",
 "timestamp": "2020-05-27T12:02:12.51Z"
},
{
 "lead-id": 12,
 "event-id": 2,
 "event-type": "order-submitted",
 "payment-deadline": "2020-05-30T12:02:12.51Z",
 "timestamp": "2020-05-27T12:02:12.51Z"
},
{
 "lead-id": 12,
 "event-id": 3,
 "event-type": "payment-confirmed",
 "status": "converted",
 "timestamp": "2020-05-27T12:38:44.12Z"
}
```

При поочередном применении этих событий их можно будет спроецировать в точное представление состояния, как и в исходной системе. «Восстановленные» события можно легко протестировать, спроецировав состояние и сравнив его с исходными данными.

И тем не менее важно помнить о недостатках такого подхода. Целью использования событий как источника данных (`event sourcing`) является получение надежной и последовательной истории событий предметной области для агрегатов. При таком подходе невозможно восстановить полную историю переходов состояний. В предыдущем примере мы не знаем, сколько раз агент по продажам связывался с человеком и, следовательно, сколько событий «выхода на связь» мы пропустили.

### Моделирование событий миграции

Альтернативный подход состоит в том, чтобы смириться с отсутствием знаний о прошлых событиях и явно смоделировать их как событие. Взамен восстановления событий, которые могли привести к текущему состоянию, следует определить событие миграции и использовать его для инициализации потоков событий существующих экземпляров агрегата:

```json
{
 "lead-id": 12,
 "event-id": 0,
 "event-type": "migrated-from-legacy",
 "first-name": "Shauna",
 "last-name": "Mercia",
 "phone-number": "555-4753",
 "status": "converted",
 "last-contacted-on": "2020-05-27T12:02:12.51Z",
 "order-placed-on": "2020-05-27T12:02:12.51Z",
 "converted-on": "2020-05-27T12:38:44.12Z",
 "followup-on": null
}
```

Преимущество этого подхода в том, что в нем явно признается отсутствие прошлых данных. Ни на каком этапе никто не может ошибочно предположить, что поток событий фиксирует все события предметной области, которые произошли в течение жизненного цикла экземпляра агрегата. Недостатком является то, что в хранилище событий навсегда останутся следы устаревшей системы. К примеру, если используется паттерн `CQRS` (вероятнее всего, с моделью предметной области, основанной на событиях), проекции всегда должны учитывать события миграции.

## Организационные изменения

На структуру системы могут повлиять и изменения в самой организации. В главе 4 были рассмотрены различные модели интеграции ограниченных контекстов: партнерство (`partnership`), общее ядро (`shared kernel`), конформист (`conformist`), предохранительный слой (`anticorruption layer`), сервис с открытым протоколом (`open-host service`) и разные пути (`separate ways`). Изменения в структуре организации могут повлиять на уровни общения и совместной работы команд и, как следствие, на способы интеграции ограниченных контекстов.

Типичный пример такого изменения — выросшие центры разработки (рис. 11.2). Поскольку ограниченный контекст может быть реализован только одной командой, добавление новых групп разработчиков может привести к тому, что существующие ограниченные контексты с более широкими границами будут разбиты на более мелкие, чтобы каждая группа могла работать со своим собственным ограниченным контекстом. 

![[Рис. 11.2. Разбиение широкого ограниченного контекста с целью задействования новых групп разработчиков.png]]

Более того, имеющиеся в организации центры разработки часто находятся в разных географических точках. Когда работа над существующими ограниченными контекстами переносится в другое место, это может негативно сказаться на совместной работе команд. В результате паттерны интеграции ограниченных контекстов должны развиваться должным образом в соответствии с описаниями приведенных ниже сценариев.

### Переход от партнерства к отношениям потребитель-поставщик

Модель партнерства предполагает тесную связь между командами и их сотрудничество. Со временем ситуация может измениться. Например, когда работа над одним из ограниченных контекстов перемещается в удаленный центр разработки. Такое изменение усложнит связь между командами и может стать причиной перехода от модели партнерства к отношениям клиент-поставщик.

### Переход от отношений потребитель-поставщик к модели разных путей

К сожалению, у команд нередко возникают серьезные проблемы со связью. Проблемы могут быть вызваны географической удаленностью или же организационной политикой. Со временем такие команды могут испытывать нарастающие проблемы с интеграцией. В какой-то момент может оказаться более рентабельным дублировать функциональность, исключив необходимость постоянно догонять друг друга.

## Знания предметной области

Вспомним, что основной принцип предметно-ориентированного проектирования заключается в том, что для разработки успешной программной системы требуется знание предметной области. Приобретение знаний предметной области является одним из самых сложных аспектов разработки программного обеспечения, особенно это касается основных поддоменов. Логика основного поддомена не только сложна, но и подвержена частым изменениям. Более того, моделирование является непрерывным процессом. И по мере приобретения новых знаний в предметной области модели должны совершенствоваться.

Зачастую сложность предметной области не лежит на поверхности. Изначально все кажется простым и понятным. Но первоначальная простота часто обманчива и быстро превращается в сложность. По мере добавления функций выявляется все больше и больше граничных случаев, инвариантов и правил. Осознание новых обстоятельств порой приводит к разрушительному эффекту, требуя перестройки модели с нуля, включая границы ограниченных контекстов, агрегатов и других деталей реализации.

Со стратегической позиции проектирования полезной эвристикой является проектирование границ ограниченных контекстов в соответствии с уровнем знаний предметной области. Затраты на разбиение системы на ограниченные контексты, оказавшиеся со временем неверно выбранными, могут быть весьма высокими. Поэтому, когда логика предметной области неясна и подвержена частым изменениям, имеет смысл проектировать ограниченные контексты с более широкими границами. Затем, по мере приобретения более подробных знаний предметной области и снижения изменчивости бизнес-логики, эти широкие ограниченные контексты можно разбить на контексты с меньшим охватом или на микросервисы. Более подробно взаимодействие ограниченных контекстов и микросервисов будет рассмотрено в главе 14.

При обнаружении новых аспектов предметной области их следует использовать для развития дизайна и повышения его стабильности. К сожалению, изменения в знании предметной области не всегда имеют положительный аспект, бывает так, что знания утрачиваются. Со временем устаревает документация, из компании увольняются люди, изначально работавшие над проектом, а наивное (`ad hoc`) добавление по мере необходимости новых функций приводит к тому, что в какой-то момент кодовая база обретает сомнительный статус унаследованной системы.

Крайне важно заранее предотвращать такую деградацию знаний предметной области. Эффективным инструментом для восстановления этих знаний является практика `EventStorming`, являющегося темой следующей главы.

## Рост проекта

Рост проекта является признаком здоровой системы. Постоянное добавление новых функций говорит об успешности системы, приносящей явную пользу своим клиентам и расширяющейся с целью более полного удовлетворения потребностей пользователей и сохранения сервиса на уровне конкурирующих продуктов. Но у роста есть темная сторона. По мере роста программного проекта его кодовая база может превратиться в большой ком грязи:

> «Большой ком грязи» — беспорядочный, расползающийся, состоящий из костылей и изоленты лапшекод (спагетти-код). Подобные системы имеют явные признаки беспорядочного роста из-за необходимости постоянного внесения хаков и костылей. 
> 	*– Брайан Фут и Джозеф Йодер (`Brian Foote and Joseph Yoder`)*

Неконтролируемый рост, приводящий к формированию больших комков грязи, является результатом расширения функциональности программной системы без пересмотра ее проектных решений. Рост расширяет границы компонентов, все больше расширяя их функциональные возможности. Изучать влияние роста на дизайн крайне важно, в частности потому, что многие инструменты предметно-ориентированного проектирования связаны с установлением границ: структурные бизнес-блоки (поддомены), модель (ограниченные контексты), неизменяемость (объекты-значения) или согласованность (агрегаты).

Руководящий принцип борьбы со сложностью, вызванной ростом продукта, заключается в выявлении и устранении ничем не оправданной сложности, вызванной устаревшим дизайном. Необходимой сложностью или сложностью, присущей предметной области, нужно управлять с помощью инструментов и методов предметно-ориентированного проектирования.

При рассмотрении аспектов предметно-ориентированного проектирования в предыдущих главах прослеживался процесс, начинающийся с анализа предметной области бизнеса и ее стратегических компонентов и продолжающийся разработкой соответствующих моделей предметной области, а затем уже разработкой и реализацией моделей в программном коде. Давайте, чтобы справиться со сложностью, обусловленной ростом проекта, будем пользоваться тем же сценарием.

### Поддомены

Как известно из главы 1, определить границы поддоменов бывает нелегко, в результате чего вместо стремления к определению идеальных границ нужно стараться найти те границы, от которых можно получить максимальную выгоду. То есть поддомены должны позволять идентифицировать компоненты с различной бизнес-ценностью, а для отработки решения следует воспользоваться подходящими инструментами.

По мере роста предметной области границы поддомена могут размываться еще больше, что затруднит выявление тех случаев, когда поддомен охватит сразу несколько более мелких поддоменов. Следовательно, важно пересмотреть идентифицированные подобласти и воспользоваться эвристикой согласованных сценариев действий (наборов сценариев действий, работающих с одним и тем же набором данных), чтобы попытаться определить, где можно будет разбить поддомен (см. рис. 11.3). 

![[Рис. 11.3. Оптимизация границ поддоменов с целью подстраивания под разрастание проекта.png]]

Способность выделять более мелкие подобласти разных типов связана с важным навыком проникать вглубь вопроса, позволяющим управлять неизбежной сложностью предметной области. Чем точнее будет информация о подобластях и их типах, тем эффективнее будут подбираться технические решения для каждого поддомена.

Определение скрытых поддоменов, которые можно было бы извлечь и сделать явными, играет особенно важную роль для основных поддоменов. Нужно всегда стремиться отделить основные поддомены от всех остальных, чтобы можно было прилагать максимум усилий к наиболее важным аспектам с точки зрения выработанной бизнес-стратегии.

### Ограниченные контексты

Из главы 3 известно, что шаблон ограниченного контекста позволяет воспользоваться различными моделями предметной области. Вместо построения модели «обо всем и ни о чем» (универсальной), можно создать несколько моделей, каждая из которых будет направлена на решение конкретной задачи.

По мере развития и роста проекта ограниченные контексты нередко теряют свою направленность и накапливают логику, связанную с разными задачами. Это так называемая непреднамеренная сложность. Как и в случае с поддоменами, крайне важно периодически пересматривать границы ограниченных контекстов. Нужно всегда изыскивать возможности упрощения модели, вычленяя из нее ограниченные контексты, сфокусированные на решении конкретных задач.

Рост проекта может также перевести имеющиеся скрытые проблемы проектирования в явные. Например, можно заметить, что ряд ограниченных контекстов со временем начинает страдать «болтливостью», будучи не в состоянии завершить какую-либо операцию без вызова другого ограниченного контекста. Это может быть явным сигналом о неэффективности модели, которую следует устранить путем изменения границ ограниченных контекстов, повысив их автономность.

### Агрегаты

При рассмотрении паттерна модели предметной области в главе 6 для проектирования границ агрегатов использовался следующий руководящий принцип:

> *Эмпирическое правило заключается в том, чтобы агрегаты были как можно меньше и включали только те объекты, которые должны находиться в строго согласованном состоянии в рамках предметной области.*

По мере роста системных бизнес-требований новые функции может быть «удобнее» распределять между уже имеющимися агрегатами, не пересматривая принцип поддержания небольших размеров агрегатов. Если агрегат разрастается и включает данные, не нужные для строгой согласованности всей его бизнес-логики, это опять же будет непреднамеренной сложностью, от которой следует избавляться.

Извлечение бизнес-функций с ее помещением в специально выделенный агрегат не только упрощает исходный агрегат, но и потенциально может упростить ограниченный контекст, к которому он принадлежит. Часто такая переделка выявляет дополнительную ранее скрытую модель, которая, став явной, должна быть выделена в другой ограниченный контекст.

# Вывод

Как говорил Гераклит, единственным постоянным в жизни являются перемены. И предприятия здесь не являются исключением. Чтобы сохранять конкурентоспособность, компании постоянно стремятся развиваться и переизобретать самих себя. Эти изменения следует рассматривать как первостепенные элементы процесса проектирования.

По мере развития предметной области изменения в ее подобластях должны быть идентифицированы и учтены при проектировании системы. Убедитесь, что ваши прошлые проектные решения соответствуют текущему состоянию предметной области и ее подобластей. Дизайн нужно развивать по мере необходимости, добиваясь от него большего соответствия текущей бизнес-стратегии и потребностям бизнеса.

Также важно осознавать, что на общение и сотрудничество между командами, а также на способы интеграции их ограниченных контекстов могут повлиять изменения в организационной структуре. Изучение предметной области — непрерывный процесс. Со временем, по мере более глубокого изучения предметной области, новые знания нужно использовать для разработки стратегических и тактических проектных решений.

И наконец, рост программного продукта является вполне благоприятным типом изменений, но при неправильном управлении может привести к катастрофическим последствиям для дизайна и архитектуры системы. Следовательно:

*   При расширении функциональности поддоменов постарайтесь уточнить их границы, что позволит принять более взвешенные проектные решения.
*   Не позволяйте ограниченному контексту стать «обо всем и ни о чем» (универсальным). Убедитесь, что модели, охваченные ограниченными контекстами, ориентированы на решение конкретных задач.
*   Убедитесь, что ваши агрегаты имеют наименьшие границы. Для обнаружения возможностей извлечения бизнес-логики в новые агрегаты воспользуйтесь эвристикой строго согласованных данных.

И последние мудрые мысли по этой теме: постоянно проверять различные границы на наличие признаков сложности, обусловленной ростом проекта. Примите меры к устранению непреднамеренной сложности и воспользуйтесь инструментами предметно-ориентированного проектирования с целью управления существенной сложностью предметной области.

















